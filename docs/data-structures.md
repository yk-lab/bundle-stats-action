# Bundle Stats Action ãƒ‡ãƒ¼ã‚¿æ§‹é€ ä»•æ§˜æ›¸

## 1. å…¥åŠ›ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

### 1.1 webpack-stats.json

WebpackãŒç”Ÿæˆã™ã‚‹çµ±è¨ˆæƒ…å ±ãƒ•ã‚¡ã‚¤ãƒ«ã®æ§‹é€ ï¼š

```typescript
interface WebpackStats {
  // ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±
  version?: string
  hash?: string
  time?: number
  builtAt?: number

  // ã‚¢ã‚»ãƒƒãƒˆæƒ…å ±ï¼ˆä¸»è¦ãªè§£æå¯¾è±¡ï¼‰
  assets: Asset[]

  // ãã®ä»–ã®æƒ…å ±ï¼ˆå°†æ¥ã®æ‹¡å¼µç”¨ï¼‰
  chunks?: Chunk[]
  modules?: Module[]
  errors?: string[]
  warnings?: string[]
}

interface Asset {
  name: string // ãƒ•ã‚¡ã‚¤ãƒ«å (e.g., "main.js", "vendor.bundle.js")
  size: number // ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºï¼ˆãƒã‚¤ãƒˆå˜ä½ï¼‰
  chunks: (string | number)[] // é–¢é€£ã™ã‚‹ãƒãƒ£ãƒ³ã‚¯ID
  emitted: boolean // ãƒ•ã‚¡ã‚¤ãƒ«ãŒå‡ºåŠ›ã•ã‚ŒãŸã‹
  isOverSizeLimit?: boolean // Webpackã®ã‚µã‚¤ã‚ºåˆ¶é™è¶…éãƒ•ãƒ©ã‚°

  // è¿½åŠ æƒ…å ±
  info?: {
    immutable?: boolean // ä¸å¤‰ã‚¢ã‚»ãƒƒãƒˆã‹
    minimized?: boolean // åœ§ç¸®æ¸ˆã¿ã‹
    development?: boolean // é–‹ç™ºãƒ“ãƒ«ãƒ‰ã‹
    hotModuleReplacement?: boolean
  }
}
```

### 1.2 ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å…¥åŠ›ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

```typescript
interface ActionInputs {
  statsPath: string // webpack-stats.jsonã®ãƒ‘ã‚¹
  bundleSizeThreshold: number // å€‹åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºé–¾å€¤ï¼ˆãƒã‚¤ãƒˆï¼‰
  totalSizeThreshold: number // åˆè¨ˆã‚µã‚¤ã‚ºé–¾å€¤ï¼ˆãƒã‚¤ãƒˆï¼‰
  failOnThresholdExceed: boolean // é–¾å€¤è¶…éæ™‚ã®å¤±æ•—ãƒ•ãƒ©ã‚°
}
```

## 2. å†…éƒ¨å‡¦ç†ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

### 2.1 è§£æçµæœ

```typescript
interface AnalysisResult {
  // ã‚¢ã‚»ãƒƒãƒˆåˆ†æçµæœ
  assets: AnalyzedAsset[]

  // ã‚µãƒãƒªãƒ¼æƒ…å ±
  summary: {
    totalSize: number
    totalSizeText: string
    fileCount: number
    exceededFileCount: number
  }

  // é–¾å€¤åˆ¤å®šçµæœ
  threshold: {
    individualExceeded: string[] // å€‹åˆ¥é–¾å€¤è¶…éãƒ•ã‚¡ã‚¤ãƒ«åãƒªã‚¹ãƒˆ
    totalExceeded: boolean // åˆè¨ˆé–¾å€¤è¶…éãƒ•ãƒ©ã‚°
    anyExceeded: boolean // ã„ãšã‚Œã‹ã®é–¾å€¤è¶…é
  }
}

interface AnalyzedAsset {
  name: string // ãƒ•ã‚¡ã‚¤ãƒ«å
  size: number // ã‚µã‚¤ã‚ºï¼ˆãƒã‚¤ãƒˆï¼‰
  sizeText: string // äººé–“å¯èª­å½¢å¼ (e.g., "1.2 MB")
  exceeded: boolean // å€‹åˆ¥é–¾å€¤è¶…éãƒ•ãƒ©ã‚°
  percentage?: number // å…¨ä½“ã«å¯¾ã™ã‚‹å‰²åˆ
}
```

### 2.2 ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆè¨­å®š

```typescript
interface FormatOptions {
  maxItems: number // è¡¨ç¤ºã™ã‚‹æœ€å¤§ãƒ•ã‚¡ã‚¤ãƒ«æ•°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 20ï¼‰
  sortBy: 'size' | 'name' // ã‚½ãƒ¼ãƒˆåŸºæº–
  showPercentage: boolean // ãƒ‘ãƒ¼ã‚»ãƒ³ãƒ†ãƒ¼ã‚¸è¡¨ç¤º
  collapsible: boolean // æŠ˜ã‚ŠãŸãŸã¿è¡¨ç¤º
}
```

## 3. å‡ºåŠ›ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

### 3.1 PRã‚³ãƒ¡ãƒ³ãƒˆæ§‹é€ 

```markdown
<!-- bundle-stats-action -->

## ğŸ“Š Bundle Size Report

**Total Size**: 5.2 MB âš ï¸ (threshold: 10 MB)

<details>
<summary>ğŸ“¦ Bundle Details (showing top 10 of 25 files)</summary>

| File       | Size   | Status           |
| ---------- | ------ | ---------------- |
| vendor.js  | 2.3 MB | âŒ Exceeds limit |
| main.js    | 1.5 MB | âœ…               |
| styles.css | 800 KB | âœ…               |
| ...        | ...    | ...              |

</details>

### âš ï¸ Threshold Violations

- **2 files** exceed individual size limit (2 MB)
- Total bundle size is within limit

---

<sub>Generated by Bundle Stats Action</sub>
```

### 3.2 å‡¦ç†ä¸­è¡¨ç¤º

```markdown
<!-- bundle-stats-action -->

## ğŸ“Š Bundle Size Report

â³ **Analyzing bundle stats...**

<details>
<summary>Processing details</summary>

- Reading webpack-stats.json...
- Calculating bundle sizes...
- Checking thresholds...

</details>
```

### 3.3 SVGãƒãƒƒã‚¸æ§‹é€ 

```xml
<svg xmlns="http://www.w3.org/2000/svg" width="130" height="20">
  <linearGradient id="b" x2="0" y2="100%">
    <stop offset="0" stop-color="#bbb" stop-opacity=".1"/>
    <stop offset="1" stop-opacity=".1"/>
  </linearGradient>
  <clipPath id="a">
    <rect width="130" height="20" rx="3" fill="#fff"/>
  </clipPath>
  <g clip-path="url(#a)">
    <path fill="#555" d="M0 0h75v20H0z"/>
    <path fill="{color}" d="M75 0h55v20H75z"/>
    <path fill="url(#b)" d="M0 0h130v20H0z"/>
  </g>
  <g fill="#fff" text-anchor="middle" font-family="DejaVu Sans,Verdana,Geneva,sans-serif" font-size="110">
    <text x="385" y="150" fill="#010101" fill-opacity=".3" transform="scale(.1)">bundle size</text>
    <text x="385" y="140" transform="scale(.1)">bundle size</text>
    <text x="1015" y="150" fill="#010101" fill-opacity=".3" transform="scale(.1)">{size}</text>
    <text x="1015" y="140" transform="scale(.1)">{size}</text>
  </g>
</svg>
```

è‰²ã®å®šç¾©:

- `#4c1`: æ­£å¸¸ï¼ˆç·‘ï¼‰
- `#fa0`: è­¦å‘Šï¼ˆé»„ï¼‰
- `#e05`: ã‚¨ãƒ©ãƒ¼ï¼ˆèµ¤ï¼‰

## 4. ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ§‹é€ 

### 4.1 ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

```typescript
interface ErrorResponse {
  code: string // ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰
  message: string // ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  details?: string // è©³ç´°æƒ…å ±ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
  file?: string // é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«
  line?: number // è¡Œç•ªå·ï¼ˆè©²å½“ã™ã‚‹å ´åˆï¼‰
}
```

### 4.2 ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ä¸€è¦§

| ã‚³ãƒ¼ãƒ‰               | èª¬æ˜                             | ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ |
| -------------------- | -------------------------------- | ---------- |
| `FILE_NOT_FOUND`     | webpack-stats.jsonãŒè¦‹ã¤ã‹ã‚‰ãªã„ | CIå¤±æ•—     |
| `PARSE_ERROR`        | JSONè§£æã‚¨ãƒ©ãƒ¼                   | CIå¤±æ•—     |
| `INVALID_SCHEMA`     | æœŸå¾…ã•ã‚Œã‚‹æ§‹é€ ã¨ç•°ãªã‚‹           | CIå¤±æ•—     |
| `API_ERROR`          | GitHub API ã‚¨ãƒ©ãƒ¼                | è­¦å‘Š&ç¶™ç¶š  |
| `THRESHOLD_EXCEEDED` | é–¾å€¤è¶…é                         | è¨­å®šã«ä¾å­˜ |

## 5. GitHub APIé–¢é€£

### 5.1 ã‚³ãƒ¡ãƒ³ãƒˆæ¤œç´¢ã‚¯ã‚¨ãƒª

```typescript
interface CommentSearchParams {
  owner: string
  repo: string
  issue_number: number
  identifier: string // "bundle-stats-action"
}
```

### 5.2 ã‚³ãƒ¡ãƒ³ãƒˆæ›´æ–°ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰

```typescript
interface CommentPayload {
  body: string // Markdownã‚³ãƒ³ãƒ†ãƒ³ãƒ„
  comment_id?: number // æ›´æ–°æ™‚ã®ã¿
}
```

## 6. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ ï¼ˆå°†æ¥ã®æ‹¡å¼µï¼‰

### 6.1 .bundle-stats.ymlï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

```yaml
# å°†æ¥çš„ãªè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚µãƒãƒ¼ãƒˆ
version: 1
thresholds:
  individual:
    - pattern: '*.js'
      limit: 2MB
    - pattern: '*.css'
      limit: 500KB
  total: 10MB

display:
  maxFiles: 20
  sortBy: size
  showDiff: true

ignore:
  - '*.map'
  - 'test/**/*'
```

## 7. ã‚µã‚¤ã‚ºè¨ˆç®—ã¨ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

### 7.1 ã‚µã‚¤ã‚ºå˜ä½å¤‰æ›

```typescript
interface SizeUnit {
  bytes: number
  unit: 'B' | 'KB' | 'MB' | 'GB'
  formatted: string // e.g., "1.23 MB"
}

// å¤‰æ›ãƒ«ãƒ¼ãƒ«
// < 1024 B    -> "xxx B"
// < 1024 KB   -> "x.xx KB"
// < 1024 MB   -> "x.xx MB"
// >= 1024 MB  -> "x.xx GB"
```

### 7.2 åˆæœŸ/æœ€çµ‚ãƒãƒ³ãƒ‰ãƒ«ã®åˆ¤å®š

```typescript
interface BundleType {
  isInitial: boolean // ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆã‹
  isAsync: boolean // éåŒæœŸãƒ­ãƒ¼ãƒ‰ã•ã‚Œã‚‹ã‹
  isVendor: boolean // ãƒ™ãƒ³ãƒ€ãƒ¼ãƒãƒ³ãƒ‰ãƒ«ã‹
}

// åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯
// - chunksé…åˆ—ãŒæ•°å€¤ã‚’å«ã‚€ -> initial
// - ãƒ•ã‚¡ã‚¤ãƒ«åã«'vendor'ã‚’å«ã‚€ -> vendor
// - ãƒ•ã‚¡ã‚¤ãƒ«åã«æ•°å€¤ãƒãƒƒã‚·ãƒ¥ã®ã¿ -> async
```

## 8. å‡ºåŠ›ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

```typescript
interface ActionOutputs {
  commentBody: string // æŠ•ç¨¿ã•ã‚ŒãŸã‚³ãƒ¡ãƒ³ãƒˆã®å†…å®¹
  exceeded: string // "true" | "false" (æ–‡å­—åˆ—)
  badgeSvg: string // SVGãƒãƒƒã‚¸ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
  totalSize: string // åˆè¨ˆã‚µã‚¤ã‚ºï¼ˆãƒã‚¤ãƒˆï¼‰
  fileCount: string // ãƒ•ã‚¡ã‚¤ãƒ«æ•°
}
```

ã“ã‚Œã‚‰ã®ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã¯ã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®å…¥åŠ›ã‹ã‚‰å‡ºåŠ›ã¾ã§ä¸€è²«æ€§ã‚’ä¿ã¡ã€å‹å®‰å…¨æ€§ã‚’ç¢ºä¿ã™ã‚‹ãŸã‚ã®åŸºç›¤ã¨ãªã‚Šã¾ã™ã€‚
